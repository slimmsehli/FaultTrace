name: CI

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:


permissions:
  contents: write

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Agent run
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          cd agent
          python agent_test.py |& tee run.log
   
           #echo "---- Count occurrences ----" 
           #true_count=$(grep -c 'isError=True' run.log || true)
           #false_count=$(grep -c 'isError=False' run.log || true)
           
           echo "---- Run Summary ----"
           #echo "isError=True  : ${true_count}"
           #echo "isError=False : ${false_count}"

